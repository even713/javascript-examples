<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>d3 bubble chart</title>
    <style>
        .node{
            fill: #ccc;
            stroke: #fff;
            stroke-width: 2px;
        }

        .container{
            display: -webkit-flex;
            display: flex;
        }

        .chart {
            -webkit-flex: 2;
            flex: 2;
            border: 1px solid grey;
            height: 500px;
        }

        .action {
            -webkit-flex: 1;
            flex: 1;
            border: 1px solid grey;
            height: 500px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="action chart-1-actions">
            Bubble chart actions:<br/>
            <button onclick="startChart()">Start</button><br/>
            <button  onclick="updateNodes()">Update</button><br/>
            <button onclick="resizeChart()">Resize</button>
        </div>
        <div class="chart chart1"></div>
        <div class="action chart-2-actions">
            Bubble chart with pie actions:<br/>
            <button onclick="startChart()">Start</button><br/>
            <button  onclick="updateNodes()">Update</button><br/>
            <button onclick="resizeChart()">Resize</button>
        </div>
        <div class="chart chart2"></div>
    </div>
</body>
<script src="/vendor/d3/d3.v35.js"></script>
<!--<script src="https://d3js.org/d3.v3.js"></script>-->
<script src="BubbleChartClass.js"></script>
<script>
     var width = 250 * 2,
     	 height = 250 * 2,
             chartInstance = [],
             data;

     d3.json("data.json", function(response){
         data = convertData(response);
     });

     function resizeChart(){
         width = 300;
         height = 300;
         chartInstance[0].resizeChart(width, height);
     }

     function startChart(){
         for(let i = 0; i < 1; i ++) {
             chartInstance.push(new BubbleChartClass({
                 width: width,
                 height: height,
                 container: ".chart" + (i + 1),
                 gravity: 0.45,
                 friction: 0.3
             }, data))
         }
     }

     function updateNodes(){
         d3.json("data2.json", function(data){
             chartInstance[0].refresh(convertData(data));
         });
     }

     var HealthLevels = {
         "Critical": {color: "rgb(219, 27, 27)"},
         "Major": {color: "rgb(255, 99, 33)"},
         "Minor": {color: "rgb(255, 208, 51)"},
         "Normal": {color: "rgb(123, 220, 42)"},
         "NoData": {color: "#ccc"}
     };

    function getHealthLevel(healthScore){
        let levels = d3.keys(HealthLevels);
        if(healthScore >= 0 && healthScore < 25) {
            return levels[0];
        } else if(healthScore >= 25 && healthScore < 50) {
            return levels[1];
        } else if(healthScore >= 50 && healthScore < 75) {
            return levels[2];
        } else if(healthScore >= 75 && healthScore <= 100) {
            return levels[3];
        } else {
            return levels[4];
        }
    }

    function convertData(response){
        response.forEach(function(d){
            let level = getHealthLevel(d.healthScore);
            d.color = HealthLevels[level].color;
            //d.value = 300;
        });

        return response;
    }

</script>